<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href='/static/style.css' />
    <script src="/static/script.js"></script>
    <title>Offense Tags</title>
</head>

<body>
    <div class="topnav">
        <a href="/hello">Home</a>
        {% if user_source == 'accounts_cics' %}
        <a href="/menu">My Reports</a>
        {% endif %}

        <!-- Conditionally show the "Tag Sanction" button based on user source (accounts_coordinators) -->
        {% if user_source == 'accounts_coordinators' %}
        <a href="/menu">Reports</a>
        {% endif %}
        <a href="/forms">Forms</a>
        <a href="#about">Notifications</a>
        <a class="logout" href="/logout">Logout</a>
    </div>
    {% if user_source == 'accounts_cics' %}
    <h1>My Reports</h1>
    {% endif %}

    {% if user_source == 'accounts_coordinators' %}
    <h1>Reports</h1>
    <div id="table-container">
        <table>
            <thead>
                <tr>               
                    <th>SR-CODE</th>
                    <th>Date and Time</th>
                    <th>Department</th>
                    <th>Status</th>
                    <th>Attached Form</th>
                    <th>Attached Supporting Document</th>
                    <th>Action</th>
                    <th>Change Status</th>
                    <th>Delete Report</th>
                </tr>
            </thead>
            <tbody>
                {% for row in reports %}
                <tr>
                    <td>{{ row[1] }}</td>
                    <td>{{ row[2] }}</td>
                    <td>{{ row[4] }}</td>
                    <td>{{ row[5] }}</td>
                    <td><a href="{{ url_for('download_report_file', report_id=row[0]) }}" target="_blank">{{ row[7] }}</a></td>
                    <td><a href="{{ url_for('download_supporting_document', report_id=row[0]) }}" target="_blank">{{ row[10] }}</a></td>
                    <td><button class="view-report-button" onclick="openModal('{{ row[3] }}')">View Report</button></td>
                    <td>
                        <!-- Add a form to change the status -->
                        <form method="POST" action="{{ url_for('change_report_status', report_id=row[0]) }}"
                              onsubmit="return confirm('Are you sure you want to change the status?');">
                            <select name="new_status">
                                <option value="On Going">On Going</option>
                                <option value="Rejected">Rejected</option>
                                <option value="Case Closed">Case Closed</option>
                            </select>
                            <button type="submit">Change</button>
                        </form>
                    </td>
                    <td>
                        <!-- Add a form to change the status -->
                        <form method="POST" action="{{ url_for('delete_report', report_id=row[0]) }}"
                              onsubmit="return confirm('Are you sure you want to delete this report?');">
                            <button type="submit">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}
    

    <div id="reports-container">
        {% if user_source == 'accounts_cics' %}
        {% for row in reports %}
        <div class="report">
            <b>Date and Time:</b> {{ row[2] }}<br>
            <b>Department:</b> {{ row[4] }}<br>   
            <b>Status:</b> {{ row[5] }}<br>
            <button class="view-report-button" onclick="openModal('{{ row[3] }}')">View Report</button>
            {% if row[5] %}
            <b>Attached Form:</b>
            <br>
            <a id="form"href="{{ url_for('download_report_file', report_id=row[0]) }}" target="_blank">{{ row[7] }}</a>
            {% endif %}
            {% if row[7] %}
            <br>
            <b>Attached Supporting Document:</b>
            <br>
            <a id="support"href="{{ url_for('download_supporting_document', report_id=row[0]) }}" target="_blank">{{ row[10] }}</a>
            {% endif %}
        </div>
        <hr class="report-separator">
        {% endfor %}
        {% endif %}
    </div>

    <!-- The Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="reportContent"></div>
        </div>
    </div>
</body>
</html>
